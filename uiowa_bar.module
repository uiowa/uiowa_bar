<?php

/**
 * @file
 * 
 * Adds the University of Iowa Branding Bar to your theme
 */

/* Include CSS Assets */
drupal_add_css(drupal_get_path('module', 'uiowa_bar') . '/css/ui-global-bar.css');

/* Include Javascript Assets */
drupal_add_js(drupal_get_path('module', 'uiowa_bar') . '/js/uniform/jquery.uniform.min.js');
drupal_add_js(drupal_get_path('module', 'uiowa_bar') . '/js/ui-header.js');


/* HTML Preprocesses */
function uiowa_bar_preprocess_html(&$vars) {
  global $theme_key;
  
  // Add a body class for the active theme name.
  $vars['classes_array'][] = theme_get_setting('ui_globalbar');
  $vars['classes_array'][] = theme_get_setting('ui_globalbar_link_style');
}


/* Implements hook_form_system_theme_settings_alter() to add Theme Customization to Theme Settings Page */
function uiowa_bar_form_system_theme_settings_alter(&$form, &$form_state)  {
  // Custom UI Branded Bar Styles
  $form['at-settings']['ui_branding'] = array(
    '#type' => 'fieldset',
    '#title' => t('UI Branding'),
    '#description' => t('<h3>UI Branding Bar</h3><p>This setting allows you to customize the top University of Iowa branded bar.</p>'),
  );

  $form['at-settings']['ui_branding']['ui_globalbar'] = array(
    '#type' => 'select',
    '#title' => t('Color Palette'),
    '#default_value' => theme_get_setting('ui_globalbar', variable_get('theme_default','none')),
    '#description' => t('Choose the color palette of the UI Branded Bar'),
    '#options' => array(
      'skin-a' => t('Light Theme'),
      'skin-b' => t('Dark Theme'),
    ),
  );
  
  $form['at-settings']['ui_branding']['ui_globalbar_link_style'] = array(
    '#type' => 'select',
    '#title' => t('Link Style'),
    '#default_value' => theme_get_setting('ui_globalbar_link_style', variable_get('theme_default','none')),
    '#description' => t('Choose the link style for the UI Branded Bar action links'),
    '#options' => array(
      'link-style-icons' => t('Icon-based'),
      'link-style-text' => t('Text-based'),
    ),
  );
}

/* Implement hook_theme() */
function uiowa_bar_theme(){
  return array(
    'uiowa_bar' => array(
        'path'      => drupal_get_path('module', 'uiowa_bar').'/theme',
        'template'  => 'uiowa-bar',
    )
  );
}

/* Add uiowa_bar markup to page */
function uiowa_bar_page_build(&$page) {
  global $theme_key;
  if (variable_get('theme_default','none') === $theme_key) {
    print theme('uiowa_bar');
  }
}